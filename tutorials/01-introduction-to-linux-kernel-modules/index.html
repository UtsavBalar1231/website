<!DOCTYPE html>
<html lang="en" data-theme="classic-dark">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Introduction to Linux Kernel Modules - Utsav Balar</title>
	<meta name="description"
		content="Learn the fundamentals of Linux kernel modules and create your first &#39;Hello World&#39; kernel module on the Raspberry Pi 5" />
	<meta name="keywords"
		content="Utsav Balar, Embedded Linux, BSP Engineer, Linux Kernel, Device Drivers, Custom ROM, Vicharak, Rockchip, Qualcomm, ARM Architecture, U-Boot, Yocto, Buildroot, AOSP, Android, Raspberry Pi, RK3399, RK3588, Samsung Exynos, FreeBSD, Open Source" />
	<meta name="author" content="Utsav Balar" />
	<meta name="robots" content="index, follow" />
	<meta name="geo.region" content="IN-GJ" />
	<meta name="geo.placename" content="Surat, Gujarat, India" />

	<!-- Open Graph -->
	<meta property="og:title" content="Introduction to Linux Kernel Modules - Utsav Balar | Embedded Linux Engineer" />
	<meta property="og:description"
		content="Learn the fundamentals of Linux kernel modules and create your first &#39;Hello World&#39; kernel module on the Raspberry Pi 5" />
	<meta property="og:type" content="website" />
	<meta property="og:url" content="https://utsavbalar.in/tutorials/01-introduction-to-linux-kernel-modules/" />
	<meta property="og:image" content="https://utsavbalar.in/icons/icon-512x512.png" />
	<meta property="og:locale" content="en_US" />
	<meta property="og:site_name" content="Utsav Balar" />

	<!-- Twitter Card -->
	<meta name="twitter:card" content="summary" />
	<meta name="twitter:site" content="@UtsavTheCunt" />
	<meta name="twitter:creator" content="@UtsavTheCunt" />
	<meta name="twitter:title" content="Introduction to Linux Kernel Modules - Utsav Balar | Embedded Linux Engineer" />
	<meta name="twitter:description"
		content="Learn the fundamentals of Linux kernel modules and create your first &#39;Hello World&#39; kernel module on the Raspberry Pi 5" />
	<meta name="twitter:image" content="https://utsavbalar.in/icons/icon-512x512.png" />

	<!-- PWA -->
	<link rel="manifest" href="/manifest.json" />
	<meta name="theme-color" content="#0f0f0f" />

	<!-- Favicon -->
	<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
	<link rel="icon" type="image/x-icon" href="/favicon.ico" />

	<!-- Styles -->
	<link rel="stylesheet" href="/css/main.css" />

	<!-- JSON-LD Structured Data -->
	<script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@graph": [
          {
            "@type": "Person",
            "@id": "https://utsavbalar.in/#person",
            "name": "Utsav Balar",
            "givenName": "Utsav",
            "familyName": "Balar",
            "jobTitle": "Embedded Linux & BSP Engineer",
            "description": "Linux Kernel Developer specializing in embedded systems and custom ROM development",
            "url": "https://utsavbalar.in/",
            "image": "https://utsavbalar.in/icons/icon-512x512.png",
            "email": "utsavbalar1231@gmail.com",
            "telephone": "+91-7600-529-280",
            "address": {
              "@type": "PostalAddress",
              "addressLocality": "Surat",
              "addressRegion": "Gujarat",
              "addressCountry": "IN",
              "postalCode": "395006"
            },
            "sameAs": [
              "https://github.com/UtsavBalar1231",
              "https://linkedin.com/in/utsavbalar",
              "https://twitter.com/UtsavTheCunt",
              "https://t.me/utsavthecunt",
              "https://reddit.com/user/utsavthecunt",
              "https://open.spotify.com/user/21xsxpeenbk6f6cedao77vxpy"
            ],
            "knowsAbout": [
              "Linux Kernel Development",
              "Embedded Systems",
              "BSP Engineering",
              "Device Drivers",
              "Custom ROM Development",
              "ARM Architecture",
              "Raspberry Pi",
              "Rockchip SoCs"
            ],
            "alumniOf": [
              {
                "@type": "EducationalOrganization",
                "name": "National Institute of Technology, Meghalaya",
                "address": "Meghalaya, India"
              },
              {
                "@type": "EducationalOrganization",
                "name": "UKA Tarsadia University",
                "address": "Gujarat, India"
              }
            ]
          },
          {
            "@type": "WebSite",
            "@id": "https://utsavbalar.in/#website",
            "url": "https://utsavbalar.in/",
            "name": "Utsav Balar - Embedded Linux Engineer",
            "description": "Portfolio of Utsav Balar, Embedded Linux & BSP Engineer",
            "publisher": {
              "@id": "https://utsavbalar.in/#person"
            },
            "potentialAction": {
              "@type": "SearchAction",
              "target": "https://utsavbalar.in/?search={search_term_string}",
              "query-input": "required name=search_term_string"
            }
          }
        ]
      }
    </script>
</head>

<body>
	<a href="#main-content" class="skip-link">Skip to main content</a>
	<div class="terminal-container">
		<header class="ascii-header" role="banner">
    <pre class="ascii-logo" aria-label="Utsav Balar ASCII Logo">
 ██╗   ██╗████████╗███████╗ █████╗ ██╗   ██╗    ██████╗  █████╗ ██╗      █████╗ ██████╗ 
 ██║   ██║╚══██╔══╝██╔════╝██╔══██╗██║   ██║    ██╔══██╗██╔══██╗██║     ██╔══██╗██╔══██╗
 ██║   ██║   ██║   ███████╗███████║██║   ██║    ██████╔╝███████║██║     ███████║██████╔╝
 ██║   ██║   ██║   ╚════██║██╔══██║╚██╗ ██╔╝    ██╔══██╗██╔══██║██║     ██╔══██║██╔══██╗
 ╚██████╔╝   ██║   ███████║██║  ██║ ╚████╔╝     ██████╔╝██║  ██║███████╗██║  ██║██║  ██║
  ╚═════╝    ╚═╝   ╚══════╝╚═╝  ╚═╝  ╚═══╝      ╚═════╝ ╚═╝  ╚═╝╚══════╝╚═╝  ╚═╝╚═╝  ╚═╝
    </pre>
    <div class="terminal-info">
        <div class="terminal-line">
            <span class="prompt">user@embedded-linux:~$</span> 
            <span class="command">cat /etc/motd</span>
        </div>
        <div class="terminal-output">
            <p>Welcome to Utsav Balar's embedded development environment</p>
            <p>Kernel: Linux massiveDingus 6.15.8-arch1-2 #1 SMP PREEMPT_DYNAMIC Tue, 29 Jul 2025 15:05:00 +0000 x86_64 GNU/Linux | Shell: /bin/zsh</p>
            <p>Last login: Thu Aug 01 12:00:00 IST 2025</p>
        </div>
    </div>
</header>


		<nav class="terminal-nav" role="navigation" aria-label="Main navigation">
			<div class="terminal-line">
    <span class="prompt">user@embedded-linux:~$</span> 
    <span class="command">ls -la ~/portfolio/</span>
</div>
<ul class="nav-list" role="menubar">
    <li class="nav-item" role="none">
        <a href="/" class="nav-link " role="menuitem">
            <span class="file-perms">drwxr-xr-x</span>
            <span class="file-name">home/</span>
        </a>
    </li>
    <li class="nav-item" role="none">
        <a href="/about/" class="nav-link " role="menuitem">
            <span class="file-perms">-rw-r--r--</span>
            <span class="file-name">about.md</span>
        </a>
    </li>
    <li class="nav-item" role="none">
        <a href="/projects/" class="nav-link " role="menuitem">
            <span class="file-perms">drwxr-xr-x</span>
            <span class="file-name">projects/</span>
        </a>
    </li>
    <li class="nav-item" role="none">
        <a href="/resume/" class="nav-link " role="menuitem">
            <span class="file-perms">-rw-r--r--</span>
            <span class="file-name">resume.pdf</span>
        </a>
    </li>
    <li class="nav-item" role="none">
        <a href="/tutorials/" class="nav-link nav-active" role="menuitem">
            <span class="file-perms">drwxr-xr-x</span>
            <span class="file-name">tutorials/</span>
        </a>
    </li>
    <li class="nav-item" role="none">
        <a href="/books/" class="nav-link " role="menuitem">
            <span class="file-perms">-rw-r--r--</span>
            <span class="file-name">books.txt</span>
        </a>
    </li>
    <li class="nav-item" role="none">
        <a href="/quotes/" class="nav-link " role="menuitem">
            <span class="file-perms">-rw-r--r--</span>
            <span class="file-name">quotes.db</span>
        </a>
    </li>
    <li class="nav-item" role="none">
        <a href="/contact/" class="nav-link " role="menuitem">
            <span class="file-perms">-rw-r--r--</span>
            <span class="file-name">contact.vcard</span>
        </a>
    </li>
</ul>

		</nav>

		<main class="terminal-content" id="main-content"><h1>Introduction to Linux Kernel Modules</h1>
<pre><code class="language-bash">$ lsmod | head -5
Module                  Size  Used by
brcmfmac              379392  0
brcmutil               24576  1 brcmfmac
cfg80211              1019904  1 brcmfmac
rfkill                 32768  2 bluetooth,cfg80211
</code></pre>
<h2>What Are Kernel Modules?</h2>
<p>Linux kernel modules are pieces of code that can be loaded and unloaded into the kernel upon demand. They extend the functionality of the kernel without requiring a system reboot. Modules are ideal for device drivers, filesystem drivers, and system calls.</p>
<blockquote>
<p><strong>Warning</strong>: Kernel modules run with the same privileges as the kernel itself. They can access kernel functions and data structures directly, with no performance overhead.</p>
</blockquote>
<h2>Why Use Kernel Modules?</h2>
<p>Kernel modules offer several advantages:</p>
<ol>
<li><strong>Modularity</strong>: Keep the kernel small by only loading functionality when needed</li>
<li><strong>Runtime Flexibility</strong>: Add and remove functionality without rebooting</li>
<li><strong>Development Efficiency</strong>: Develop and test drivers without constantly rebooting</li>
<li><strong>Resource Optimization</strong>: Load only the drivers needed for your hardware</li>
</ol>
<blockquote>
<p><strong>Critical</strong>: Bugs in kernel modules can crash the entire system or cause data corruption. Always test on development systems first, not production environments.</p>
</blockquote>
<h2>Setting Up Your Development Environment</h2>
<p>Before we write our first kernel module, we need to set up the development environment:</p>
<pre><code class="language-bash"># Update your system
sudo apt update &amp;&amp; sudo apt upgrade -y

# Install necessary development packages
sudo apt install build-essential bc bison flex libssl-dev libelf-dev git

# Install kernel headers (required for building kernel modules)
sudo apt install raspberrypi-kernel-headers

# Create a directory for our kernel module
mkdir -p ~/kernel-modules/hello
cd ~/kernel-modules/hello
</code></pre>
<h2>Your First Kernel Module: Hello World</h2>
<p>Let's create a simple &quot;Hello World&quot; kernel module that prints a message when loaded and unloaded.</p>
<h3>Step 1: Create the Source File</h3>
<pre><code class="language-c">#include &lt;linux/module.h&gt;    // Core module functionality
#include &lt;linux/kernel.h&gt;    // For KERN_INFO
#include &lt;linux/init.h&gt;      // For module_init and module_exit macros

MODULE_LICENSE(&quot;GPL&quot;);                      // Module license
MODULE_AUTHOR(&quot;Utsav Balar&quot;);               // Module author
MODULE_DESCRIPTION(&quot;A simple Hello World kernel module&quot;); // Module description
MODULE_VERSION(&quot;0.1&quot;);                      // Module version

/**
 * hello_init - Module initialization function
 *
 * This function runs when the module is loaded into the kernel.
 * It prints a welcome message to the kernel log.
 *
 * Return: 0 on success, negative errno on failure
 */
static int __init hello_init(void)
{
    printk(KERN_INFO &quot;Hello World: Module loaded\n&quot;);
    return 0;
}

/**
 * hello_exit - Module cleanup function
 *
 * This function runs when the module is unloaded from the kernel.
 * It prints a goodbye message to the kernel log.
 */
static void __exit hello_exit(void)
{
    printk(KERN_INFO &quot;Hello World: Module unloaded\n&quot;);
}

// Register module initialization and cleanup functions
module_init(hello_init);
module_exit(hello_exit);
</code></pre>
<h3>Step 2: Create the Makefile</h3>
<p>A Makefile is needed to build our kernel module:</p>
<pre><code class="language-makefile"># If KERNELRELEASE is defined, we're being called from the kernel build system
ifneq ($(KERNELRELEASE),)
    obj-m := hello.o

# Otherwise, we're being called directly from the command line
else
    # Path to the kernel headers
    KERNEL_DIR ?= /lib/modules/$(shell uname -r)/build
    PWD := $(shell pwd)

# Default target
all:
	$(MAKE) -C $(KERNEL_DIR) M=$(PWD) modules

# Clean target
clean:
	$(MAKE) -C $(KERNEL_DIR) M=$(PWD) clean

endif
</code></pre>
<h2>Understanding the Code</h2>
<h3>Module Metadata</h3>
<pre><code class="language-c">MODULE_LICENSE(&quot;GPL&quot;);
MODULE_AUTHOR(&quot;Utsav Balar&quot;);
MODULE_DESCRIPTION(&quot;A simple Hello World kernel module&quot;);
MODULE_VERSION(&quot;0.1&quot;);
</code></pre>
<p>These macros provide metadata about the module:</p>
<ul>
<li><code>MODULE_LICENSE</code>: Declares the license (important for compatibility)</li>
<li><code>MODULE_AUTHOR</code>: Who wrote the module</li>
<li><code>MODULE_DESCRIPTION</code>: What the module does</li>
<li><code>MODULE_VERSION</code>: The module's version number</li>
</ul>
<h3>Module Initialization Function</h3>
<pre><code class="language-c">static int __init hello_init(void)
{
    printk(KERN_INFO &quot;Hello World: Module loaded\n&quot;);
    return 0;
}
</code></pre>
<p>The <code>__init</code> marker tells the kernel that this function is only needed during initialization. After the module is loaded, this memory can be freed.</p>
<p>The function must return 0 on success or a negative error code on failure.</p>
<h3>Module Cleanup Function</h3>
<pre><code class="language-c">static void __exit hello_exit(void)
{
    printk(KERN_INFO &quot;Hello World: Module unloaded\n&quot;);
}
</code></pre>
<p>The <code>__exit</code> marker tells the kernel that this function is only needed during module removal.</p>
<h3>Function Registration</h3>
<pre><code class="language-c">module_init(hello_init);
module_exit(hello_exit);
</code></pre>
<p>These macros register our functions as the initialization and cleanup handlers for our module.</p>
<h2>Building and Testing the Module</h2>
<p>Now let's build and test our kernel module:</p>
<pre><code class="language-bash"># Build the module
make

# Check that the module was built successfully
ls -l hello.ko

# Load the module
sudo insmod hello.ko

# Check that the module is loaded
lsmod | grep hello

# View kernel log messages
dmesg | tail

# Unload the module
sudo rmmod hello

# Check log messages again to see the unload message
dmesg | tail
</code></pre>
<h2>Understanding the Kernel Module Build Process</h2>
<p>The build process for kernel modules is different from normal user-space programs:</p>
<ol>
<li>The source code is compiled against the kernel headers</li>
<li>The module is linked against kernel symbols</li>
<li>The result is a <code>.ko</code> (kernel object) file</li>
<li>This file can be loaded into and unloaded from the running kernel</li>
</ol>
<p>The build system sets up the correct environment, including:</p>
<ul>
<li>Compiler flags matching the kernel build</li>
<li>Symbol table information</li>
<li>Module versioning and compatibility info</li>
</ul>
<h2>Module Parameters</h2>
<p>Kernel modules can accept parameters at load time. Let's modify our module to accept a string parameter:</p>
<pre><code class="language-c">#include &lt;linux/module.h&gt;
#include &lt;linux/kernel.h&gt;
#include &lt;linux/init.h&gt;
#include &lt;linux/moduleparam.h&gt;

MODULE_LICENSE(&quot;GPL&quot;);
MODULE_AUTHOR(&quot;Utsav Balar&quot;);
MODULE_DESCRIPTION(&quot;Hello World module with parameters&quot;);
MODULE_VERSION(&quot;0.2&quot;);

// Define a string parameter with a default value
static char *name = &quot;world&quot;;
// Register the parameter
module_param(name, charp, S_IRUGO);
MODULE_PARM_DESC(name, &quot;The name to display in hello message&quot;);

static int __init hello_init(void)
{
    printk(KERN_INFO &quot;Hello %s: Module loaded\n&quot;, name);
    return 0;
}

static void __exit hello_exit(void)
{
    printk(KERN_INFO &quot;Goodbye %s: Module unloaded\n&quot;, name);
}

module_init(hello_init);
module_exit(hello_exit);
</code></pre>
<p>To load this module with a custom parameter:</p>
<pre><code class="language-bash"># Build the module
make

# Load the module with a parameter
sudo insmod hello.ko name=&quot;Raspberry Pi&quot;

# Check the kernel log
dmesg | tail

# Unload the module
sudo rmmod hello
</code></pre>
<h2>Automatic Module Loading</h2>
<p>In production systems, modules are typically loaded automatically by the kernel when needed, using one of these methods:</p>
<ol>
<li><strong>Device Tree Matching</strong>: For platform and device drivers</li>
<li><strong>PCI/USB ID Matching</strong>: For PCI and USB devices</li>
<li><strong>Module Alias</strong>: For aliases in the module configuration</li>
<li><strong>Dependency Resolution</strong>: Via modprobe and modules.dep</li>
</ol>
<h2>Debugging Kernel Modules</h2>
<p>Debugging kernel modules is different from user-space code:</p>
<ol>
<li><strong>Kernel Logs</strong>: The primary debugging tool (use <code>dmesg</code> or <code>journalctl</code>)</li>
<li><strong>printk Priorities</strong>: Different message levels (<code>KERN_EMERG</code>, <code>KERN_ALERT</code>, etc.)</li>
<li><strong>Dynamic Debug</strong>: Enable selective debug messages</li>
<li><strong>KGDB</strong>: Kernel debugger for advanced debugging</li>
</ol>
<h2>Common Pitfalls</h2>
<p>When developing kernel modules, watch out for these common issues:</p>
<ol>
<li><strong>Missing Cleanup</strong>: Always release all resources in the exit function</li>
<li><strong>Kernel Version Compatibility</strong>: Kernel APIs can change between versions</li>
<li><strong>Race Conditions</strong>: Kernel code is highly concurrent</li>
<li><strong>Memory Corruption</strong>: Buffer overflows in kernel space crash the system</li>
<li><strong>Stack Limitations</strong>: Kernel stack is much smaller than user-space stack</li>
</ol>
<h2>Next Steps</h2>
<p>Now that you've created your first kernel module, you're ready to learn about more advanced topics:</p>
<ol>
<li><a href="/tutorials/02-character-device-drivers-fundamentals/">Character device drivers</a></li>
<li><a href="/tutorials/03-kernel-memory-management-for-drivers/">Memory management in the kernel</a></li>
<li><a href="/tutorials/04-synchronization-primitives/">Kernel synchronization mechanisms</a></li>
<li><a href="/tutorials/05-interrupt-handling-and-workqueues/">Interrupt handling</a></li>
</ol>
<h2>Summary</h2>
<p>In this tutorial, you've learned the basics of Linux kernel modules:</p>
<ol>
<li>What kernel modules are and why they're used</li>
<li>How to set up a development environment</li>
<li>How to write a basic kernel module</li>
<li>How to build and load/unload a module</li>
<li>How to use module parameters</li>
<li>Basic debugging techniques</li>
</ol>
<p>With this foundation, you're now ready to explore more complex kernel programming topics in the next tutorials.</p>
<h2>References</h2>
<ol>
<li><a href="https://www.kernel.org/doc/html/latest/admin-guide/kernel-parameters.html">Linux Kernel Documentation: Module Parameters</a></li>
<li><a href="https://www.kernel.org/doc/html/latest/admin-guide/modules.html">Linux Kernel Documentation: Kernel Modules</a></li>
<li><a href="https://www.amazon.com/Linux-Driver-Development-Embedded-Processors/dp/1729321828">Linux Driver Development for Embedded Processors</a></li>
<li><a href="https://www.amazon.com/Linux-Kernel-Development-Robert-Love/dp/0672329468">Linux Kernel Development</a></li>
</ol>
<hr>
<p><em>Last updated: May 24, 2025</em></p>
</main>

		<footer class="terminal-footer"><div class="terminal-line">
    <span class="prompt">user@embedded-linux:~$</span> 
    <span class="command">cat /sys/class/dmi/id/product_name</span>
</div>
<div class="terminal-output">
    <p>&copy; 2025 Utsav Balar. Licensed under MIT.</p>
    <p>Built with Eleventy &middot; Hosted on GitHub Pages &middot; Source available on <a href="https://github.com/UtsavBalar1231" target="_blank" rel="noopener">GitHub</a></p>
</div>
<div class="terminal-line">
    <span class="prompt">user@embedded-linux:~$</span> 
    <span class="cursor">█</span>
</div>
</footer>
	</div>

	<!-- Theme switcher -->
	<div class="theme-switcher" role="toolbar" aria-label="Theme selection" aria-describedby="theme-help">
		<div id="theme-help" class="sr-only">
			Use these buttons to switch between different color themes, or press T to cycle through them
		</div>
		<button class="theme-btn" data-theme="classic-dark" aria-label="Classic dark theme" aria-pressed="true">
			<span class="theme-indicator" aria-hidden="true"></span>
			<span class="sr-only">Classic Dark</span>
		</button>
		<button class="theme-btn" data-theme="light" aria-label="Light theme" aria-pressed="false">
			<span class="theme-indicator" aria-hidden="true"></span>
			<span class="sr-only">Light</span>
		</button>
		<button class="theme-btn" data-theme="hacker-green" aria-label="Hacker green theme" aria-pressed="false">
			<span class="theme-indicator" aria-hidden="true"></span>
			<span class="sr-only">Hacker Green</span>
		</button>
		<button class="theme-btn" data-theme="matrix" aria-label="Matrix theme" aria-pressed="false">
			<span class="theme-indicator" aria-hidden="true"></span>
			<span class="sr-only">Matrix</span>
		</button>
		<button class="theme-btn" data-theme="solarized-dark" aria-label="Solarized dark theme" aria-pressed="false">
			<span class="theme-indicator" aria-hidden="true"></span>
			<span class="sr-only">Solarized Dark</span>
		</button>
	</div>

	<!-- Scripts -->
	<script src="/js/bundle.js"></script>

	<!-- Service Worker Registration -->
	<script>
		if ('serviceWorker' in navigator) {
			window.addEventListener('load', () => {
				navigator.serviceWorker
					.register('/sw.js')
					.then(registration => console.log('SW registered'))
					.catch(registrationError => console.log('SW registration failed'));
			});
		}
	</script>
</body>

</html>
